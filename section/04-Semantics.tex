
\clearpage{}
\section{Semantics}

% ---------------------------------------------------------
\begin{figure}
\begin{small}
\begin{alltt}
Name   ::= ...
Ctor   ::= ...
Label  ::= ...

Decl   ::= rule Name Rule
Rule   ::= await Guard+ to Action
Guard  ::= Ctor as Var where Term

Type   ::= unit | text | symbol | nat | party
        |  set Type | Type \(\to\) Type

Term   ::= Var | Term Term | \(\lambda\) Var : Type \(\to\) Term
        |  [ (Label = Term)* ] | Term . Label

Value  ::= Lit | \(\lambda\) Var : Type \(\to\) Term
        |  [ (Label = Value)* ]

Action ::= done | Action ; Action
        |  say Ctor [ (Label = Exp)* ]
           by  Term  use Term  for Term  obs Term
\end{alltt}
\end{small}

\caption{Core Language Grammar}
\end{figure}

\input{figure/Static.tex}

\input{figure/Dynamic.tex}



\begin{figure}
\begin{small}
\begin{alltt}
fact  Coin   [stamp: Symbol, holder: Party]
fact  Offer  [id: Symbol, giver: Party, receiver: Party]
fact  Accept [id: Symbol, accepter: Party]

node  Bank

rule  transfer
await Accept  as accept
 and  Offer   as offer
      where   accept.id       == offer.id,
              accept.accepter == offer.receiver
 and  Coin    as coin
      where   coin.holder     == offer.giver
to
      say Coin [ stamp  = coin.stamp
               , holder = offer.receiver]
      by  [auth| Bank, offer.receiver]
      use (elem offer.receiver)

scenario Bank, Alice, Bob
to do say Coin   [ stamp = 'Coin1001, holder = Alice]
      by  [auth| Bank, Alice]
      use (elem Alice)

      say Offer  [ id    = '1234
                 , giver = Alice, receiver = Bob]
      by  Alice use (elem Bob)

      say Accept [ id = '1234,    accepter = Bob]
      by  Bob   use (const true)
\end{alltt}
\end{small}

\caption{Coin Transfer Workflow}
\label{f:CoinTransferDesugared}
\end{figure}
