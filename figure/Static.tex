
% -----------------------------------------------------------------------------
% Static Semantics
% -----------------------------------------------------------------------------


\begin{figure}
$$
\begin{array}{cl}

% -- Rule -------------------------------------------------
\fbox{$\jOk{Decls}{Rule}$}
\\[2ex]

\ruleI  {    \jTypeMatch{\Sigma}{\cdot}{H^n}{\Gamma}
         \qq \jType{\Sigma}{\Gamma}{M}{\kSet~ \kFACT} }
        {\jOk{\Sigma}{\krule~ N~ \kawait~ H^n~ \kto~ M}}
\end{array}
$$
\vspace{1ex}

% -- Matches ----------------------------------------------
$$
\begin{array}{cl}
\fbox{$\jTypeMatch{Decls}{Env}{Matches}{Env}$}
\\[2ex]
\jTypeMatch{\Sigma}{\Gamma}{\cdot}{\Gamma}
\\[2ex]
\ruleI  {   \jTypeMatch{\Sigma}{\Gamma}{H}{\Gamma'}
        \qq \jTypeMatch{\Sigma}{\Gamma'}{H^n}{\Gamma''} }
        {\jTypeMatch{\Sigma}{\Gamma}{H~H^n}{\Gamma''}}
\end{array}
$$
\vspace{1ex}


% -- Match ------------------------------------------------
$$
\begin{array}{cl}
\fbox{$\jTypeMatch{Decls}{Env}{Match}{Env}$}
\\[2ex]
\ruleI  {\begin{array}{ll}
            \jTypeGather{\Sigma}{\Gamma}{X ~;~ N ~;~ M}{\Gamma'}
        \\  \jOk{\Gamma'}{S} \quad
            \jType{\cdot}{\Gamma'}{M'}{\kNat} \quad
            \jType{\cdot}{\Gamma'}{M''}{\kSet~ \kParty}
         \end{array}
        }
        {\jTypeMatch
                {\Sigma}{\Gamma}
                {\hspace{-1ex}
                 X~ \kfrom~ N~ \kwhere~ M~ \kselect~ S~ \kconsume~ M'~ \kgain~ M''}
                {\Gamma'}}
\end{array}
$$
\vspace{1ex}


% -- Gather -----------------------------------------------
$$
\begin{array}{cl}
\fbox{$\jTypeGather{Decls}{Env}{Var ~;~ Name ~;~ Term}{Env}$}
\\[2ex]
\ruleI  {    (N : T) \in \Sigma
         \quad \Gamma' = \Gamma,~ X : \kFact~ T
         \quad \jType{\cdot}{\Gamma'}{M}{\kBool}
        }
        {\jTypeGather{\Sigma}{\Gamma}{X ~;~ N ~;~ M}{\Gamma'}}
\end{array}
$$
\vspace{1ex}


% -- Select ---------------------------------------------
$$
\begin{array}{cl}
\fbox{$\jOk{Env}{Select}$}
\\[2ex]
\jOk    {\Gamma}{\kany}
\qq
\ruleI  {\jType{\cdot}{\Gamma}{M}{\kNat}}
        {\jOk  {\Gamma}{\kfirst~ M}}
\qq
\ruleI  {\jType{\cdot}{\Gamma}{M}{\kNat}}
        {\jOk  {\Gamma}{\klast~ M}}
\end{array}
$$
\vspace{1ex}


% -- Term -------------------------------------------------
$$
\begin{array}{cl}
\fbox{$\jType{Decls}{Env}{Term}{Type}$}
\\[2ex]
\ruleI  { (X : T) \in \Gamma }
        {\jType{\Sigma}{\Gamma}{X}{T}}

\qq
\ruleI  {       \jType  {\Sigma}{\Gamma,~ X:T}
                        {M}{T'}}
        {       \jType  {\Sigma}{\Gamma}
                        {\lambda X:T.~ M}{T \to T'}
        }

\\[2ex]
\ruleI  {       \jType  {\Sigma}{\Gamma}{M}{T \to T'}
        \qq     \jType  {\Sigma}{\Gamma}{M'}{T}
        }
        {       \jType  {\Sigma}{\Gamma}{M~ M'}{T'}
        }
\\[2ex]
\ruleI  { \{    \jType  {\Sigma}{\Gamma}
                        {M_i}{T_i} \}^{i \gets 1..n} }
        {       \jType  {\Sigma}{\Gamma}
                        {[ l_1:M_1 \ldots l_n:M_n  ]}
                        {[ l_1:T_1 \ldots l_n:T_n ]}
        }
\\[2ex]
\ruleI  {       \jType  {\Sigma}{\Gamma}
                        {M}{[ l_1:M_1 \ldots l_n:M_n]}
          \qq   l:T \in \{l_1:T_1 \ldots l_n:T_n \}
        }
        {       \jType  {\Sigma}{\Gamma}
                        { M ~.~ l }{T} }
\\[2ex]
\ruleI  { \begin{array}{ll}
           (N : T) \in \Sigma
           \\   \jType  {\Sigma}{\Gamma}
                        {M_{payload}} {T}
            &   T = [ l_1 : T_1 \ldots l_n : T_n ]
           \\   \jType  {\Sigma}{\Gamma}
                        {M_{by}} {\kSet~ \kParty}
            &   \jType  {\Sigma}{\Gamma}
                        {M_{obs}}{\kSet~ \kParty}
           \\   \jType  {\Sigma}{\Gamma}
                        {M_{use}}{\kSet~ \kSymbol}
            &   \jType  {\Sigma}{\Gamma}
                        {M_{num}}{\kNat~}
          \end{array}
        }
        {\begin{array}{ll}
         \Gamma ~|~ \Sigma ~\vdash
                   & \hspace{-1ex} \ksay~  N_{tag}~ M_{payload}
                \\ & \hspace{-1ex} \kby~~~ M_{by}  ~~\kobs~ M_{obs} ~~\kuse~ M_{use} ~~\knum~ M_{num}
                :: \kFACT
         \end{array}
        }

\end{array}
$$

\caption{Static Semantics}
\label{f:Statics}
\end{figure}